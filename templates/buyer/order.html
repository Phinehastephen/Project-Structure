{% extends "layout.html" %}
{% block content %}

<h2>Order Tracking — #{{ order[0] }}</h2>

<div class="card p-3 mb-4">
    <p><strong>Total Amount:</strong> ₦{{ order[1] }}</p>

    <p><strong>Status:</strong>
        {% set status = order[2] %}
        {% if status == "pending" %}
            <span class="badge bg-warning text-dark">Pending</span>
        {% elif status == "approved" %}
            <span class="badge bg-primary">Approved</span>
        {% elif status == "shipped" %}
            <span class="badge bg-info text-dark">Shipped</span>
        {% elif status == "delivered" %}
            <span class="badge bg-success">Delivered</span>
        {% elif status == "cancelled" %}
            <span class="badge bg-danger">Cancelled</span>
        {% else %}
            <span class="badge bg-secondary">Unknown</span>
        {% endif %}
    </p>

    <p><strong>Shipping Address:</strong> {{ order[3] }}</p>
    <p><strong>Date:</strong> {{ order[4].strftime('%Y-%m-%d %H:%M') }}</p>
</div>

<!-- STATUS PROGRESS BAR -->
<h4>Order Progress</h4>

{% set progress = {
    'pending': 25,
    'approved': 50,
    'shipped': 75,
    'delivered': 100,
    'cancelled': 0
} %}

{% set bar_width = progress.get(status, 0) %}

<div class="progress mb-4" style="height: 30px;">
    <div class="progress-bar
        {% if status == 'cancelled' %}bg-danger
        {% elif status == 'pending' %}bg-warning text-dark
        {% elif status == 'approved' %}bg-primary
        {% elif status == 'shipped' %}bg-info text-dark
        {% elif status == 'delivered' %}bg-success
        {% else %}bg-secondary
        {% endif %}"
        role="progressbar"
        style="width: {{ bar_width }}%;">
        {{ status | capitalize }}
    </div>
</div>

<h4>Items in this Order</h4>

<table class="table table-bordered">
    <tr>
        <th>Product</th>
        <th>Price (₦)</th>
        <th>Qty</th>
        <th>Total (₦)</th>
    </tr>

    {% for item in items %}
    <tr>
        <td>{{ item[0] }}</td>
        <td>{{ item[1] }}</td>
        <td>{{ item[2] }}</td>
        <td>{{ item[1] * item[2] }}</td>
    </tr>
    {% endfor %}
</table>

<p>
    <strong>Estimated Delivery:</strong>
    {% if order[5] %}
        {{ order[5].strftime('%Y-%m-%d') }}
    {% else %}
        <span class="text-muted">Not set yet — order still processing</span>
    {% endif %}
</p>

<!-- CANCEL ORDER -->
{% if status == "pending" %}
<form method="POST" action="/buyer/order/cancel/{{ order[0] }}">
    <button class="btn btn-danger mt-3"
            onclick="return confirm('Are you sure you want to cancel this order?');">
        Cancel Order
    </button>
</form>
{% endif %}

{% endblock %}
