{% extends "layout.html" %}
{% block content %}

<h2>Your Cart</h2>

<!-- EMPTY CART MESSAGE -->
{% if cart_items|length == 0 %}
    <div class="alert alert-warning text-center mt-4">
        Your cart is empty. Add products to continue.
    </div>
{% endif %}

{% if cart_items|length > 0 %}
<table class="table table-bordered mt-3 align-middle">
    <thead class="table-dark">
        <tr>
            <th>Product</th>
            <th>Price (₦)</th>
            <th>Quantity</th>
            <th>Subtotal</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
    {% for item in cart_items %}
    <tr>
        <!-- PRODUCT IMAGE + NAME -->
        <td>
            <div class="d-flex align-items-center gap-3">
                <img 
                    src="{{ url_for('static', filename='uploads/' ~ (item[4] if item[4] else 'placeholder.png')) }}"
                    width="100"
                    height="100"
                    style="object-fit: cover; border-radius: 6px;"
                >
                <strong>{{ item[1] }}</strong>
            </div>
        </td>

        <!-- PRICE -->
        <td>₦{{ "%.2f"|format(item[2]) }}</td>

        <!-- QUANTITY UPDATE -->
        <td style="width: 160px;">
            <form action="/buyer/cart/update/{{ item[0] }}" method="POST" class="d-flex">
                <input 
                    type="number"
                    name="quantity"
                    value="{{ item[3] }}"
                    min="1"
                    class="form-control form-control-sm"
                    style="width: 80px;"
                >
                <button class="btn btn-sm btn-success ms-2">✔</button>
            </form>
        </td>

        <!-- SUBTOTAL -->
        <td>
            <strong>₦{{ "%.2f"|format(item[2] * item[3]) }}</strong>
        </td>

        <!-- DELETE BUTTON -->
        <td>
            <a href="/buyer/cart/delete/{{ item[0] }}"
               class="btn btn-sm btn-danger">
                Remove
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<!-- TOTAL + CHECKOUT -->
<div class="text-end mt-4">
    <h3>Total: ₦{{ "%.2f"|format(total) }}</h3>
    <a href="/buyer/checkout" class="btn btn-dark btn-lg mt-3">
        Proceed to Checkout
    </a>
</div>

{% endif %}

{% endblock %}
